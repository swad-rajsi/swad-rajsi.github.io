<!DOCTYPE html>
<html>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-95Q2G5RF8X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-95Q2G5RF8X');
</script>
<script>
document.addEventListener('click', function(e) {
  const link = e.target.closest('a');
  if (!link) return;

  const href = link.getAttribute('href');
  if (!href) return;

  // Track internal recipe clicks
  if (href.startsWith('/recipes/')) {
    gtag('event', 'recipe_click', {
      event_category: 'engagement',
      event_label: href
    });
  }
});
</script>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }} | Recipes</title>
  <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}">
</head>

<body>
  {% include navigation.html %}

  <main class="recipe">

    <div class="swad-rajsi-centre-display"
      style="margin-top:-30px;margin-bottom:10px;color: #d25fd2ff;font-size:30px;font-family:Georgia;justify-content:left !important;">
      {{page.title}}</div>
    <div style="display: flex;justify-content: center;align-items: center;">
      {% if page.image %}
      <img src="{{ page.image | relative_url }}" onerror="this.style.display='none'" class="recipe-img">
      {% endif %}
    </div>
    <div style="font-size: 1em;
    border-style: double;
    border-width: 1px;
    border-color: #417505;
    padding: 10px;
    background-color: rgb(238, 233, 233);
    max-width: 950px;border-radius: 4px;">
      <div style="padding: 10px;font-size: 20px;font-family:Georgia;color: #d25fd2ff;">Table of Contents</div>
      <div style="padding: 5px;"><a href="#Ingredients" style="text-decoration: none;"><span
            style="padding-right:10px;">1).</span><span>Ingredients</span></a></div>
      <div style="padding: 5px;"><a href="#Steps" style="text-decoration: none;"><span
            style="padding-right:10px;">2).</span><span>Steps</span></a></div>
    </div>

    <div id="Ingredients" style="font-size: 1em;
    border-style: double;
    border-width: 1px;
    border-color: #417505;
    padding: 10px;
    background-color: bisque;
    max-width: 950px;margin-top: 20px;border-radius: 4px;">
      <div style="padding: 10px;font-size: 20px;font-family:Georgia;color: #d25fd2ff;">Ingredients</div>
      <div>
        <table style="border-style: dotted; 
    border-width: 2px;border-color:gray;padding:10px;width:100%; font-size: 13px; margin-bottom:20px;">
          <tr style="font-weight:bold;">
            <td class="swad-rajsi-td-border">Preparation Time</td>
            <td class="swad-rajsi-td-border">Cook Time</td>
            <td class="swad-rajsi-td-border">Course</td>
            <td class="swad-rajsi-td-border">Flavour</td>
            <td class="swad-rajsi-td-border">Type</td>
            <td class="swad-rajsi-td-border" style="border-right: none !important;">Serving</td>
          </tr>
          <tr>
            <td class="swad-rajsi-td-border">{{page.prep_time}}</td>
            <td class="swad-rajsi-td-border">{{page.cook_time}}</td>
            <td class="swad-rajsi-td-border">{{page.course}}</td>
            <td class="swad-rajsi-td-border">{{page.flavour}}</td>
            <td class="swad-rajsi-td-border">{{page.food_type}}</td>
            <td class="swad-rajsi-td-border" style="border-right: none !important;">
              <div>
                <div class="serving-box">
                  <div id="servingValue" style="padding-right:10px;text-align: center;margin-bottom: 5px;">
                    {{page.serving}}</div>
                </div>
                <div class="serving-button-group">
                  <button class="serving-btn active" onclick="setValue(1, this)">1x</button>
                  <button class="serving-btn" onclick="setValue(2, this)">2x</button>
                  <button class="serving-btn" onclick="setValue(3, this)">3x</button>
                </div>
              </div>
            </td>
          </tr>
        </table>
      </div>
      <div>
        <ul style="padding-left:20px;">
          {% for section in page.ingredients %}
          <li style="font-size: 15px;padding-bottom:10px;">
            <strong>{{ section.heading }}</strong>

            <ol class="alpha-paren" style="margin-top: 5px;">
              {% for item in section.items %}
              <li class="swad-rajsi-ingredients ingredient-item" data-qty="{{ item.qty }}" data-unit="{{ item.unit }}"
                data-scale="{{ item.scale }}" data-name="{{ item.name }}"><span class="qty">{{ item.qty
                  }}</span> {{ item.unit }} 
                  {% if item.link %}
                    <a href="{{ item.link }}" target="_blank" rel="noopener">{{ item.name }}</a>
                  {% else %}
                    {{ item.name }}
                  {% endif %}   
                </li>
              {% endfor %}
            </ol>
          </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div id="Steps"
      style="padding:10px;color: #d25fd2ff;font-size:20px;font-family:Georgia;justify-content:left !important;padding-bottom:5px;">
      Steps</div>
      {% for step in page.steps %}
      <h4 style="font-size: 14px;margin-top: 5px;margin-bottom:3px;padding-top:5px;padding-left:15px;">{{ step.title }}</h4>
      <ol class="swad-rajsi-ingredients">
          {% for action in step.actions %}
            <li>{{ action }}</li>
          {% endfor %}
      </ol>
      {% endfor %}

    <div class="swad-rajsi-ingredients">{{ content }}</div>

  </main>

  {% include footer.html %}
</body>
<script>
  function setValue(value, element) {
    const baseServing = {{ page.serving_original }};
  // Update text
  document.getElementById("servingValue").innerText = value * baseServing;

  // Remove active class from all buttons
  document.querySelectorAll(".serving-btn").forEach(btn => {
    btn.classList.remove("active");
  });

  // Add active class to clicked button
  element.classList.add("active");
  document.querySelectorAll('.ingredient-item').forEach(item => {
    //console.log(item.dataset.qty + " " + item.dataset.unit + " " + item.dataset.name);
    if (item.dataset.qty !== undefined && item.dataset.qty !== '') {
      const scale = item.dataset.scale !== 'false';
      qty = item.dataset.qty.trim();
      var baseQty = Number(qty);
      if (qty.includes('/')) {
        const parts = qty.split('/');
        if (parts.length === 2) {
          const numerator = Number(parts[0]);
          const denominator = Number(parts[1]);
          if (!isNaN(numerator) && !isNaN(denominator) && denominator !== 0) {
            baseQty = numerator / denominator;
          }
        }
      }
      //console.log("Base Qty: " + baseQty + ", Scale: " + scale);
      // Skip if not scalable or not numeric
      if (!scale || isNaN(baseQty)) return;
      let newQty = baseQty * value;
      // Optional: round nicely
      //newQty = Number.isInteger(newQty) ? newQty : newQty.toFixed(1);
      item.querySelector('.qty').innerText = newQty;
    }
  });

  }
</script>

</html>